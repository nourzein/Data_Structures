{"changed":true,"filter":false,"title":"test2.js","tooltip":"/test/test2.js","value":"const { Client } = require('pg');\nconst dotenv = require('dotenv');\ndotenv.config();\nconst handlebars = require('handlebars')\nconst fs = require('fs')\nvar express = require('express'), // npm install express\n    app = express();\nvar path= require('path');\nvar bodyParser= require('body-parser')\n\nvar dir= __dirname;\n//Configure Photon\nvar device_id = process.env.PHOTON_ID;\nvar access_token = process.env.PHOTON_TOKEN;\nvar particle_variable = 'tempsensor';\nvar device_url = 'https://api.particle.io/v1/devices/' + device_id + '/' + particle_variable + '?access_token=' + access_token;\n    \n// AWS RDS POSTGRESQL INSTANCE\nvar db_credentials = new Object();\n    db_credentials.user = 'nour'; //your username\n    db_credentials.host = process.env.WEB_HOST; //your endpoint\n    db_credentials.database = 'aa';\n    db_credentials.password = process.env.POSTGPW; //password. use an environment variable \n    db_credentials.port = 5432; \n\n//DB CONFIG\nvar AWS = require('aws-sdk');\nAWS.config = new AWS.Config();\nAWS.config.region = \"us-east-2\";\nvar dynamodb = new AWS.DynamoDB();    \n\n\n//setup\n// app.engine('html', require('ejs').renderFile);\n// app.set('view engine', 'html');\napp.use(express.static(path.join(dir, '/public')));\napp.set('views', path.join(dir, 'public'));\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));â€©\n\n//route to render html file\napp.get('/aa', function(req, res) {\n    res.sendFile(dir +\"/public/aa.html\")\n    //res.render(\"aa.html\")\n});\n    \n//route to query data\napp.post('/aaData',  function(req, res) {\n    //res.send('<h3>this is the page for my sensor data</h3>');  \n    // Connect to the AWS RDS Postgres database\n// var templateVariables= {};\n\nconst client = new Client(db_credentials);\nclient.connect();\n\nvar queryDay= req.body.queryDay\n// var [from, to]=req.body.queryTime.split(\",\");\nvar queryTime= req.body.queryTime\n//queryTime= req.body.queryTime\n\n    var thisQuery = \"SELECT latitude, longitude, address, json_agg(json_build_object('Meeting Name', meetingname, 'Meeting Title', meetingtitle, 'Day', day, 'Start Time', starttime,  'End Time', endtime, 'Metting Type', meetingtype, 'Special Interest', specialinterest, 'Address', fulllocation)) as meetings FROM aaallmeetings JOIN aaallmeetinginstances ON aaallmeetings.locationid = aaallmeetinginstances.locationid WHERE (1=1) \" + queryDay +  queryTime + \" GROUP BY latitude, longitude, address;\";\n    client.query(thisQuery, (err, results) => {\n        if (err) {throw err}\n        else {\n            const data = results.rows;\n            console.log(data)\n              client.end();\n              return res.json(data);\n            // start leaflet js\n            // fs.readFile('./aa.hbs', 'utf8', (error, myData) => {\n            //     var template = handlebars.compile(myData, data)\n            //     // console.log(templateVariables)\n            //     templateVariables.blockofMeetings = data;\n            //     templateVariables.myData = JSON.stringify(data);\n            //     //console.log(templateVariables)\n            //     var html = template(templateVariables)\n            //     res.send(html)\n            // })\n        \n        }\n        \n    });\n});\n\napp.get('/aaFullData',  function(req, res) {\n    //res.send('<h3>this is the page for my sensor data</h3>');  \n    // Connect to the AWS RDS Postgres database\n// var templateVariables= {};\n\nconst client = new Client(db_credentials);\nclient.connect();\n\n    var thisQuery = \"SELECT DISTINCT latitude, longitude, address, locationid FROM aaallmeetings ;\";\n    client.query(thisQuery, (err, results) => {\n        if (err) {throw err}\n        else {\n            const data = results.rows;\n            console.log(data)\n              client.end();\n              return res.json(data);\n            // start leaflet js\n            // fs.readFile('./aa.hbs', 'utf8', (error, myData) => {\n            //     var template = handlebars.compile(myData, data)\n            //     // console.log(templateVariables)\n            //     templateVariables.blockofMeetings = data;\n            //     templateVariables.myData = JSON.stringify(data);\n            //     //console.log(templateVariables)\n            //     var html = template(templateVariables)\n            //     res.send(html)\n            // })\n        \n        }\n        \n    });\n});\n\n\n// app.get('/sensor', function(req, res1) {\n//     var templateVariables= { title: 'My Sensor Data', body: 'These are my temperatures in my room'};\n//         //res.send('<h3>this is the page for my sensor data</h3>');  \n        \n//     // Connect to the AWS RDS Postgres database\n//     const client = new Client(db_credentials);\n//     client.connect();\n    \n//     var thisQuery = \"SELECT * FROM sensorData;\";\n//     client.query(thisQuery, (err, res) => {\n//         if (err) {throw err}\n//         else {\n            \n//             fs.readFile('./sensor.html', 'utf8', (error, data) => {\n//                 var template = handlebars.compile(data)\n//                 //console.log(templateVariables)\n//                 templateVariables.temperatures = res.rows;\n//                 //console.log(templateVariables)\n//                 var html = template(templateVariables)\n//                 res1.send(html)\n//             // //console.table(res.rows);\n//             // var rows= JSON.stringify(res.rows)\n//             // res1.send(`<p> Rows ${rows} </p>`); \n//             //\n            \n//             client.end();\n//         });\n//          client.end();\n//         }\n//     });\n\n// });\n\n//dear_diary query\napp.get('/processBlog', function(req, res1) {\n    \n var templateVariables= {};\n \n    var params = {\n        TableName : \"Dear_Diary\",\n        KeyConditionExpression: \n        \"#tp = :topicName and dt between :minDate and :maxDate\", // the query expression\n        ExpressionAttributeNames: { // name substitution, used for reserved words in DynamoDB\n            \"#tp\" : \"topic\"\n        },\n        ExpressionAttributeValues: { // the query values\n            \":topicName\": { S: \"Data Structures Homework\"},\n            \":minDate\": {S: new Date(\"September 26, 2019\").toLocaleString()},\n            \":maxDate\": {S: new Date(\"September 28, 2019\").toLocaleString()}\n        }\n    };\n    dynamodb.query(params, function(err, data2) {\n      if (err) {\n        console.error(\"Unable to query. Error:\", JSON.stringify(err, null, 2));\n      } else {\n             \n             fs.readFile('./pblog.hbs', 'utf8', (error, data) => {\n                var template = handlebars.compile(data)\n                //console.log(templateVariables)\n                templateVariables.blogPost = data2.Items\n                console.log(templateVariables)\n                var html = template(templateVariables)\n                res1.send(html)\n            })\n         \n        // console.log(\"Query succeeded.\");\n        // res1.send(JSON.stringify(data.Items, null, 4));\n        // .forEach(function(item) {\n        //   console.log(\"***** ***** ***** ***** ***** \\n\", item);\n        // });\n      }\n    });\n\n});\n\n// serve static files in /public\napp.use(express.static('public'));\n\n// listen on port 8080\napp.listen(8080, function() {\n    console.log('Server listening...');\n});","undoManager":{"mark":59,"position":63,"stack":[[{"start":{"row":82,"column":3},"end":{"row":83,"column":0},"action":"insert","lines":["",""],"id":1},{"start":{"row":83,"column":0},"end":{"row":84,"column":0},"action":"insert","lines":["",""]},{"start":{"row":84,"column":0},"end":{"row":84,"column":1},"action":"insert","lines":["a"]},{"start":{"row":84,"column":1},"end":{"row":84,"column":2},"action":"insert","lines":["p"]},{"start":{"row":84,"column":2},"end":{"row":84,"column":3},"action":"insert","lines":["p"]}],[{"start":{"row":84,"column":3},"end":{"row":84,"column":4},"action":"insert","lines":["."],"id":2},{"start":{"row":84,"column":4},"end":{"row":84,"column":5},"action":"insert","lines":["p"]},{"start":{"row":84,"column":5},"end":{"row":84,"column":6},"action":"insert","lines":["o"]},{"start":{"row":84,"column":6},"end":{"row":84,"column":7},"action":"insert","lines":["s"]},{"start":{"row":84,"column":7},"end":{"row":84,"column":8},"action":"insert","lines":["t"]}],[{"start":{"row":84,"column":8},"end":{"row":84,"column":10},"action":"insert","lines":["()"],"id":3}],[{"start":{"row":84,"column":9},"end":{"row":84,"column":11},"action":"insert","lines":["''"],"id":4}],[{"start":{"row":84,"column":10},"end":{"row":84,"column":11},"action":"insert","lines":["/"],"id":5},{"start":{"row":84,"column":11},"end":{"row":84,"column":12},"action":"insert","lines":["a"]},{"start":{"row":84,"column":12},"end":{"row":84,"column":13},"action":"insert","lines":["a"]},{"start":{"row":84,"column":13},"end":{"row":84,"column":14},"action":"insert","lines":["M"]}],[{"start":{"row":84,"column":14},"end":{"row":84,"column":15},"action":"insert","lines":["e"],"id":6},{"start":{"row":84,"column":15},"end":{"row":84,"column":16},"action":"insert","lines":["e"]},{"start":{"row":84,"column":16},"end":{"row":84,"column":17},"action":"insert","lines":["t"]},{"start":{"row":84,"column":17},"end":{"row":84,"column":18},"action":"insert","lines":["i"]},{"start":{"row":84,"column":18},"end":{"row":84,"column":19},"action":"insert","lines":["n"]},{"start":{"row":84,"column":19},"end":{"row":84,"column":20},"action":"insert","lines":["g"]},{"start":{"row":84,"column":20},"end":{"row":84,"column":21},"action":"insert","lines":["s"]}],[{"start":{"row":84,"column":22},"end":{"row":84,"column":23},"action":"insert","lines":[","],"id":7}],[{"start":{"row":84,"column":23},"end":{"row":84,"column":24},"action":"insert","lines":[" "],"id":8},{"start":{"row":84,"column":24},"end":{"row":84,"column":25},"action":"insert","lines":["f"]},{"start":{"row":84,"column":25},"end":{"row":84,"column":26},"action":"insert","lines":["u"]},{"start":{"row":84,"column":26},"end":{"row":84,"column":27},"action":"insert","lines":["n"]},{"start":{"row":84,"column":27},"end":{"row":84,"column":28},"action":"insert","lines":["c"]},{"start":{"row":84,"column":28},"end":{"row":84,"column":29},"action":"insert","lines":["i"]},{"start":{"row":84,"column":29},"end":{"row":84,"column":30},"action":"insert","lines":["t"]},{"start":{"row":84,"column":30},"end":{"row":84,"column":31},"action":"insert","lines":["o"]}],[{"start":{"row":84,"column":30},"end":{"row":84,"column":31},"action":"remove","lines":["o"],"id":9},{"start":{"row":84,"column":29},"end":{"row":84,"column":30},"action":"remove","lines":["t"]},{"start":{"row":84,"column":28},"end":{"row":84,"column":29},"action":"remove","lines":["i"]}],[{"start":{"row":84,"column":28},"end":{"row":84,"column":29},"action":"insert","lines":["t"],"id":10},{"start":{"row":84,"column":29},"end":{"row":84,"column":30},"action":"insert","lines":["i"]},{"start":{"row":84,"column":30},"end":{"row":84,"column":31},"action":"insert","lines":["o"]},{"start":{"row":84,"column":31},"end":{"row":84,"column":32},"action":"insert","lines":["n"]}],[{"start":{"row":84,"column":32},"end":{"row":84,"column":34},"action":"insert","lines":["()"],"id":11}],[{"start":{"row":84,"column":33},"end":{"row":84,"column":34},"action":"insert","lines":["r"],"id":12},{"start":{"row":84,"column":34},"end":{"row":84,"column":35},"action":"insert","lines":["e"]},{"start":{"row":84,"column":35},"end":{"row":84,"column":36},"action":"insert","lines":["q"]},{"start":{"row":84,"column":36},"end":{"row":84,"column":37},"action":"insert","lines":[","]}],[{"start":{"row":84,"column":37},"end":{"row":84,"column":38},"action":"insert","lines":[" "],"id":13},{"start":{"row":84,"column":38},"end":{"row":84,"column":39},"action":"insert","lines":["r"]},{"start":{"row":84,"column":39},"end":{"row":84,"column":40},"action":"insert","lines":["e"]},{"start":{"row":84,"column":40},"end":{"row":84,"column":41},"action":"insert","lines":["x"]}],[{"start":{"row":84,"column":40},"end":{"row":84,"column":41},"action":"remove","lines":["x"],"id":14}],[{"start":{"row":84,"column":40},"end":{"row":84,"column":41},"action":"insert","lines":["s"],"id":15}],[{"start":{"row":84,"column":42},"end":{"row":84,"column":43},"action":"remove","lines":[")"],"id":16}],[{"start":{"row":84,"column":42},"end":{"row":84,"column":43},"action":"insert","lines":[" "],"id":17},{"start":{"row":84,"column":43},"end":{"row":84,"column":44},"action":"insert","lines":["{"]}],[{"start":{"row":84,"column":44},"end":{"row":86,"column":1},"action":"insert","lines":["","    ","}"],"id":18}],[{"start":{"row":85,"column":1},"end":{"row":86,"column":17},"action":"insert","lines":["const client = new Client(db_credentials);","client.connect();"],"id":19}],[{"start":{"row":86,"column":17},"end":{"row":86,"column":20},"action":"remove","lines":["   "],"id":20},{"start":{"row":86,"column":17},"end":{"row":87,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":87,"column":0},"end":{"row":88,"column":0},"action":"insert","lines":["",""],"id":21},{"start":{"row":88,"column":0},"end":{"row":89,"column":0},"action":"insert","lines":["",""]},{"start":{"row":89,"column":0},"end":{"row":90,"column":0},"action":"insert","lines":["",""]},{"start":{"row":90,"column":0},"end":{"row":91,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":88,"column":0},"end":{"row":110,"column":3},"action":"insert","lines":["   var thisQuery = \"SELECT latitude, longitude, address, json_agg(json_build_object('Meeting Name', meetingname, 'Meeting Title', meetingtitle, 'Day', day, 'Start Time', starttime,  'End Time', endtime, 'Metting Type', meetingtype, 'Special Interest', specialinterest, 'Address', fulllocation)) as meetings FROM aaallmeetings JOIN aaallmeetinginstances ON aaallmeetings.locationid = aaallmeetinginstances.locationid WHERE (1=1) \" + queryDay +  queryTime + \" GROUP BY latitude, longitude, address;\";","    client.query(thisQuery, (err, results) => {","        if (err) {throw err}","        else {","            const data = results.rows;","            console.log(data)","              client.end();","              return res.json(data);","            // start leaflet js","            // fs.readFile('./aa.hbs', 'utf8', (error, myData) => {","            //     var template = handlebars.compile(myData, data)","            //     // console.log(templateVariables)","            //     templateVariables.blockofMeetings = data;","            //     templateVariables.myData = JSON.stringify(data);","            //     //console.log(templateVariables)","            //     var html = template(templateVariables)","            //     res.send(html)","            // })","        ","        }","        ","    });","});"],"id":22}],[{"start":{"row":96,"column":8},"end":{"row":105,"column":17},"action":"remove","lines":["    // start leaflet js","            // fs.readFile('./aa.hbs', 'utf8', (error, myData) => {","            //     var template = handlebars.compile(myData, data)","            //     // console.log(templateVariables)","            //     templateVariables.blockofMeetings = data;","            //     templateVariables.myData = JSON.stringify(data);","            //     //console.log(templateVariables)","            //     var html = template(templateVariables)","            //     res.send(html)","            // })"],"id":23}],[{"start":{"row":105,"column":0},"end":{"row":105,"column":1},"action":"remove","lines":["}"],"id":24},{"start":{"row":104,"column":0},"end":{"row":105,"column":0},"action":"remove","lines":["",""]},{"start":{"row":103,"column":0},"end":{"row":104,"column":0},"action":"remove","lines":["",""]},{"start":{"row":102,"column":0},"end":{"row":103,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":88,"column":27},"end":{"row":88,"column":28},"action":"insert","lines":["D"],"id":25},{"start":{"row":88,"column":28},"end":{"row":88,"column":29},"action":"insert","lines":["i"]},{"start":{"row":88,"column":29},"end":{"row":88,"column":30},"action":"insert","lines":["s"]},{"start":{"row":88,"column":30},"end":{"row":88,"column":31},"action":"insert","lines":["t"]},{"start":{"row":88,"column":31},"end":{"row":88,"column":32},"action":"insert","lines":["i"]},{"start":{"row":88,"column":32},"end":{"row":88,"column":33},"action":"insert","lines":["n"]},{"start":{"row":88,"column":33},"end":{"row":88,"column":34},"action":"insert","lines":["c"]}],[{"start":{"row":88,"column":34},"end":{"row":88,"column":35},"action":"insert","lines":["t"],"id":26}],[{"start":{"row":88,"column":35},"end":{"row":88,"column":36},"action":"insert","lines":[" "],"id":27}],[{"start":{"row":88,"column":35},"end":{"row":88,"column":36},"action":"remove","lines":[" "],"id":28},{"start":{"row":88,"column":34},"end":{"row":88,"column":35},"action":"remove","lines":["t"]},{"start":{"row":88,"column":33},"end":{"row":88,"column":34},"action":"remove","lines":["c"]},{"start":{"row":88,"column":32},"end":{"row":88,"column":33},"action":"remove","lines":["n"]},{"start":{"row":88,"column":31},"end":{"row":88,"column":32},"action":"remove","lines":["i"]},{"start":{"row":88,"column":30},"end":{"row":88,"column":31},"action":"remove","lines":["t"]},{"start":{"row":88,"column":29},"end":{"row":88,"column":30},"action":"remove","lines":["s"]},{"start":{"row":88,"column":28},"end":{"row":88,"column":29},"action":"remove","lines":["i"]}],[{"start":{"row":88,"column":28},"end":{"row":88,"column":29},"action":"insert","lines":["I"],"id":29},{"start":{"row":88,"column":29},"end":{"row":88,"column":30},"action":"insert","lines":["S"]},{"start":{"row":88,"column":30},"end":{"row":88,"column":31},"action":"insert","lines":["T"]},{"start":{"row":88,"column":31},"end":{"row":88,"column":32},"action":"insert","lines":["I"]},{"start":{"row":88,"column":32},"end":{"row":88,"column":33},"action":"insert","lines":["N"]},{"start":{"row":88,"column":33},"end":{"row":88,"column":34},"action":"insert","lines":["C"]},{"start":{"row":88,"column":34},"end":{"row":88,"column":35},"action":"insert","lines":["T"]}],[{"start":{"row":88,"column":35},"end":{"row":88,"column":36},"action":"insert","lines":[" "],"id":30}],[{"start":{"row":88,"column":20},"end":{"row":88,"column":65},"action":"remove","lines":["SELECT DISTINCT latitude, longitude, address,"],"id":31},{"start":{"row":88,"column":20},"end":{"row":88,"column":96},"action":"insert","lines":["SELECT DISTINCT latitude, longitude, address, locationid FROM aaallmeetings "]}],[{"start":{"row":88,"column":95},"end":{"row":88,"column":96},"action":"insert","lines":[","],"id":32}],[{"start":{"row":88,"column":77},"end":{"row":88,"column":95},"action":"remove","lines":["FROM aaallmeetings"],"id":33},{"start":{"row":88,"column":76},"end":{"row":88,"column":77},"action":"remove","lines":[" "]}],[{"start":{"row":88,"column":57},"end":{"row":88,"column":66},"action":"remove","lines":["address, "],"id":34}],[{"start":{"row":88,"column":502},"end":{"row":88,"column":508},"action":"remove","lines":["ddress"],"id":35},{"start":{"row":88,"column":501},"end":{"row":88,"column":502},"action":"remove","lines":["a"]},{"start":{"row":88,"column":500},"end":{"row":88,"column":501},"action":"remove","lines":[" "]}],[{"start":{"row":88,"column":500},"end":{"row":88,"column":501},"action":"insert","lines":[" "],"id":36},{"start":{"row":88,"column":501},"end":{"row":88,"column":502},"action":"insert","lines":["L"]},{"start":{"row":88,"column":502},"end":{"row":88,"column":503},"action":"insert","lines":["O"]},{"start":{"row":88,"column":503},"end":{"row":88,"column":504},"action":"insert","lines":["C"]},{"start":{"row":88,"column":504},"end":{"row":88,"column":505},"action":"insert","lines":["A"]},{"start":{"row":88,"column":505},"end":{"row":88,"column":506},"action":"insert","lines":["T"]},{"start":{"row":88,"column":506},"end":{"row":88,"column":507},"action":"insert","lines":["I"]},{"start":{"row":88,"column":507},"end":{"row":88,"column":508},"action":"insert","lines":["O"]},{"start":{"row":88,"column":508},"end":{"row":88,"column":509},"action":"insert","lines":["N"]}],[{"start":{"row":88,"column":508},"end":{"row":88,"column":509},"action":"remove","lines":["N"],"id":37},{"start":{"row":88,"column":507},"end":{"row":88,"column":508},"action":"remove","lines":["O"]},{"start":{"row":88,"column":506},"end":{"row":88,"column":507},"action":"remove","lines":["I"]},{"start":{"row":88,"column":505},"end":{"row":88,"column":506},"action":"remove","lines":["T"]},{"start":{"row":88,"column":504},"end":{"row":88,"column":505},"action":"remove","lines":["A"]},{"start":{"row":88,"column":503},"end":{"row":88,"column":504},"action":"remove","lines":["C"]},{"start":{"row":88,"column":502},"end":{"row":88,"column":503},"action":"remove","lines":["O"]},{"start":{"row":88,"column":501},"end":{"row":88,"column":502},"action":"remove","lines":["L"]}],[{"start":{"row":88,"column":501},"end":{"row":88,"column":502},"action":"insert","lines":["l"],"id":38},{"start":{"row":88,"column":502},"end":{"row":88,"column":503},"action":"insert","lines":["o"]},{"start":{"row":88,"column":503},"end":{"row":88,"column":504},"action":"insert","lines":["c"]},{"start":{"row":88,"column":504},"end":{"row":88,"column":505},"action":"insert","lines":["a"]},{"start":{"row":88,"column":505},"end":{"row":88,"column":506},"action":"insert","lines":["t"]},{"start":{"row":88,"column":506},"end":{"row":88,"column":507},"action":"insert","lines":["i"]},{"start":{"row":88,"column":507},"end":{"row":88,"column":508},"action":"insert","lines":["o"]},{"start":{"row":88,"column":508},"end":{"row":88,"column":509},"action":"insert","lines":["n"]}],[{"start":{"row":88,"column":509},"end":{"row":88,"column":510},"action":"insert","lines":["i"],"id":39},{"start":{"row":88,"column":510},"end":{"row":88,"column":511},"action":"insert","lines":["d"]}],[{"start":{"row":88,"column":469},"end":{"row":88,"column":470},"action":"remove","lines":["\""],"id":40},{"start":{"row":88,"column":468},"end":{"row":88,"column":469},"action":"remove","lines":[" "]},{"start":{"row":88,"column":467},"end":{"row":88,"column":468},"action":"remove","lines":["+"]},{"start":{"row":88,"column":466},"end":{"row":88,"column":467},"action":"remove","lines":[" "]},{"start":{"row":88,"column":465},"end":{"row":88,"column":466},"action":"remove","lines":["e"]},{"start":{"row":88,"column":464},"end":{"row":88,"column":465},"action":"remove","lines":["m"]},{"start":{"row":88,"column":463},"end":{"row":88,"column":464},"action":"remove","lines":["i"]},{"start":{"row":88,"column":462},"end":{"row":88,"column":463},"action":"remove","lines":["T"]},{"start":{"row":88,"column":461},"end":{"row":88,"column":462},"action":"remove","lines":["y"]},{"start":{"row":88,"column":460},"end":{"row":88,"column":461},"action":"remove","lines":["r"]},{"start":{"row":88,"column":459},"end":{"row":88,"column":460},"action":"remove","lines":["e"]},{"start":{"row":88,"column":458},"end":{"row":88,"column":459},"action":"remove","lines":["u"]},{"start":{"row":88,"column":457},"end":{"row":88,"column":458},"action":"remove","lines":["q"]},{"start":{"row":88,"column":456},"end":{"row":88,"column":457},"action":"remove","lines":[" "]},{"start":{"row":88,"column":455},"end":{"row":88,"column":456},"action":"remove","lines":[" "]},{"start":{"row":88,"column":454},"end":{"row":88,"column":455},"action":"remove","lines":["+"]},{"start":{"row":88,"column":453},"end":{"row":88,"column":454},"action":"remove","lines":[" "]},{"start":{"row":88,"column":452},"end":{"row":88,"column":453},"action":"remove","lines":["y"]},{"start":{"row":88,"column":451},"end":{"row":88,"column":452},"action":"remove","lines":["a"]}],[{"start":{"row":88,"column":450},"end":{"row":88,"column":451},"action":"remove","lines":["D"],"id":41},{"start":{"row":88,"column":449},"end":{"row":88,"column":450},"action":"remove","lines":["y"]},{"start":{"row":88,"column":448},"end":{"row":88,"column":449},"action":"remove","lines":["r"]},{"start":{"row":88,"column":447},"end":{"row":88,"column":448},"action":"remove","lines":["e"]},{"start":{"row":88,"column":446},"end":{"row":88,"column":447},"action":"remove","lines":["u"]},{"start":{"row":88,"column":445},"end":{"row":88,"column":446},"action":"remove","lines":["q"]},{"start":{"row":88,"column":444},"end":{"row":88,"column":445},"action":"remove","lines":[" "]},{"start":{"row":88,"column":443},"end":{"row":88,"column":444},"action":"remove","lines":["+"]},{"start":{"row":88,"column":442},"end":{"row":88,"column":443},"action":"remove","lines":[" "]},{"start":{"row":88,"column":441},"end":{"row":88,"column":442},"action":"remove","lines":["\""]},{"start":{"row":88,"column":440},"end":{"row":88,"column":441},"action":"remove","lines":[" "]},{"start":{"row":88,"column":439},"end":{"row":88,"column":440},"action":"remove","lines":[")"]},{"start":{"row":88,"column":438},"end":{"row":88,"column":439},"action":"remove","lines":["1"]},{"start":{"row":88,"column":437},"end":{"row":88,"column":438},"action":"remove","lines":["="]},{"start":{"row":88,"column":436},"end":{"row":88,"column":437},"action":"remove","lines":["1"]},{"start":{"row":88,"column":435},"end":{"row":88,"column":436},"action":"remove","lines":["("]},{"start":{"row":88,"column":434},"end":{"row":88,"column":435},"action":"remove","lines":[" "]},{"start":{"row":88,"column":433},"end":{"row":88,"column":434},"action":"remove","lines":["E"]},{"start":{"row":88,"column":432},"end":{"row":88,"column":433},"action":"remove","lines":["R"]},{"start":{"row":88,"column":431},"end":{"row":88,"column":432},"action":"remove","lines":["E"]},{"start":{"row":88,"column":430},"end":{"row":88,"column":431},"action":"remove","lines":["H"]}],[{"start":{"row":88,"column":429},"end":{"row":88,"column":430},"action":"remove","lines":["W"],"id":42}],[{"start":{"row":88,"column":429},"end":{"row":88,"column":430},"action":"remove","lines":[" "],"id":43}],[{"start":{"row":96,"column":4},"end":{"row":97,"column":5},"action":"remove","lines":["    ","     "],"id":44},{"start":{"row":96,"column":0},"end":{"row":96,"column":4},"action":"remove","lines":["    "]},{"start":{"row":95,"column":36},"end":{"row":96,"column":3},"action":"remove","lines":["","   "]}],[{"start":{"row":88,"column":468},"end":{"row":88,"column":469},"action":"remove","lines":["d"],"id":45},{"start":{"row":88,"column":467},"end":{"row":88,"column":468},"action":"remove","lines":["i"]},{"start":{"row":88,"column":466},"end":{"row":88,"column":467},"action":"remove","lines":["n"]},{"start":{"row":88,"column":465},"end":{"row":88,"column":466},"action":"remove","lines":["o"]},{"start":{"row":88,"column":464},"end":{"row":88,"column":465},"action":"remove","lines":["i"]},{"start":{"row":88,"column":463},"end":{"row":88,"column":464},"action":"remove","lines":["t"]},{"start":{"row":88,"column":462},"end":{"row":88,"column":463},"action":"remove","lines":["a"]},{"start":{"row":88,"column":461},"end":{"row":88,"column":462},"action":"remove","lines":["c"]},{"start":{"row":88,"column":460},"end":{"row":88,"column":461},"action":"remove","lines":["o"]},{"start":{"row":88,"column":459},"end":{"row":88,"column":460},"action":"remove","lines":["l"]}],[{"start":{"row":88,"column":459},"end":{"row":88,"column":460},"action":"insert","lines":["a"],"id":46},{"start":{"row":88,"column":460},"end":{"row":88,"column":461},"action":"insert","lines":["d"]},{"start":{"row":88,"column":461},"end":{"row":88,"column":462},"action":"insert","lines":["d"]},{"start":{"row":88,"column":462},"end":{"row":88,"column":463},"action":"insert","lines":["r"]},{"start":{"row":88,"column":463},"end":{"row":88,"column":464},"action":"insert","lines":["e"]},{"start":{"row":88,"column":464},"end":{"row":88,"column":465},"action":"insert","lines":["s"]},{"start":{"row":88,"column":465},"end":{"row":88,"column":466},"action":"insert","lines":["s"]}],[{"start":{"row":88,"column":66},"end":{"row":88,"column":67},"action":"remove","lines":["d"],"id":47},{"start":{"row":88,"column":65},"end":{"row":88,"column":66},"action":"remove","lines":["i"]},{"start":{"row":88,"column":64},"end":{"row":88,"column":65},"action":"remove","lines":["n"]},{"start":{"row":88,"column":63},"end":{"row":88,"column":64},"action":"remove","lines":["o"]},{"start":{"row":88,"column":62},"end":{"row":88,"column":63},"action":"remove","lines":["i"]},{"start":{"row":88,"column":61},"end":{"row":88,"column":62},"action":"remove","lines":["t"]},{"start":{"row":88,"column":60},"end":{"row":88,"column":61},"action":"remove","lines":["a"]},{"start":{"row":88,"column":59},"end":{"row":88,"column":60},"action":"remove","lines":["c"]},{"start":{"row":88,"column":58},"end":{"row":88,"column":59},"action":"remove","lines":["o"]},{"start":{"row":88,"column":57},"end":{"row":88,"column":58},"action":"remove","lines":["l"]}],[{"start":{"row":88,"column":57},"end":{"row":88,"column":58},"action":"insert","lines":["a"],"id":48},{"start":{"row":88,"column":58},"end":{"row":88,"column":59},"action":"insert","lines":["d"]},{"start":{"row":88,"column":59},"end":{"row":88,"column":60},"action":"insert","lines":["d"]},{"start":{"row":88,"column":60},"end":{"row":88,"column":61},"action":"insert","lines":["r"]},{"start":{"row":88,"column":61},"end":{"row":88,"column":62},"action":"insert","lines":["e"]},{"start":{"row":88,"column":62},"end":{"row":88,"column":63},"action":"insert","lines":["s"]},{"start":{"row":88,"column":63},"end":{"row":88,"column":64},"action":"insert","lines":["s"]}],[{"start":{"row":88,"column":3},"end":{"row":88,"column":4},"action":"insert","lines":[" "],"id":49}],[{"start":{"row":85,"column":0},"end":{"row":85,"column":1},"action":"remove","lines":[" "],"id":50}],[{"start":{"row":85,"column":0},"end":{"row":86,"column":0},"action":"insert","lines":["",""],"id":51}],[{"start":{"row":89,"column":4},"end":{"row":100,"column":3},"action":"remove","lines":["var thisQuery = \"SELECT DISTINCT latitude, longitude, address,  json_agg(json_build_object('Meeting Name', meetingname, 'Meeting Title', meetingtitle, 'Day', day, 'Start Time', starttime,  'End Time', endtime, 'Metting Type', meetingtype, 'Special Interest', specialinterest, 'Address', fulllocation)) as meetings FROM aaallmeetings JOIN aaallmeetinginstances ON aaallmeetings.locationid = aaallmeetinginstances.locationid GROUP BY latitude, longitude, address;\";","    client.query(thisQuery, (err, results) => {","        if (err) {throw err}","        else {","            const data = results.rows;","            console.log(data)","              client.end();","              return res.json(data);","        }","        ","    });","});"],"id":52},{"start":{"row":89,"column":4},"end":{"row":111,"column":3},"action":"insert","lines":["var thisQuery = \"SELECT latitude, longitude, address, json_agg(json_build_object('Meeting Name', meetingname, 'Meeting Title', meetingtitle, 'Day', day, 'Start Time', starttime,  'End Time', endtime, 'Metting Type', meetingtype, 'Special Interest', specialinterest, 'Address', fulllocation)) as meetings FROM aaallmeetings JOIN aaallmeetinginstances ON aaallmeetings.locationid = aaallmeetinginstances.locationid WHERE (1=1) \" + queryDay +  queryTime + \" GROUP BY latitude, longitude, address;\";","    client.query(thisQuery, (err, results) => {","        if (err) {throw err}","        else {","            const data = results.rows;","            console.log(data)","              client.end();","              return res.json(data);","            // start leaflet js","            // fs.readFile('./aa.hbs', 'utf8', (error, myData) => {","            //     var template = handlebars.compile(myData, data)","            //     // console.log(templateVariables)","            //     templateVariables.blockofMeetings = data;","            //     templateVariables.myData = JSON.stringify(data);","            //     //console.log(templateVariables)","            //     var html = template(templateVariables)","            //     res.send(html)","            // })","        ","        }","        ","    });","});"]}],[{"start":{"row":89,"column":28},"end":{"row":89,"column":29},"action":"insert","lines":["D"],"id":53},{"start":{"row":89,"column":29},"end":{"row":89,"column":30},"action":"insert","lines":["I"]},{"start":{"row":89,"column":30},"end":{"row":89,"column":31},"action":"insert","lines":["S"]},{"start":{"row":89,"column":31},"end":{"row":89,"column":32},"action":"insert","lines":["T"]},{"start":{"row":89,"column":32},"end":{"row":89,"column":33},"action":"insert","lines":["I"]},{"start":{"row":89,"column":33},"end":{"row":89,"column":34},"action":"insert","lines":["N"]},{"start":{"row":89,"column":34},"end":{"row":89,"column":35},"action":"insert","lines":["C"]},{"start":{"row":89,"column":35},"end":{"row":89,"column":36},"action":"insert","lines":["T"]}],[{"start":{"row":89,"column":36},"end":{"row":89,"column":37},"action":"insert","lines":[" "],"id":54}],[{"start":{"row":89,"column":466},"end":{"row":89,"column":467},"action":"remove","lines":["\""],"id":55},{"start":{"row":89,"column":465},"end":{"row":89,"column":466},"action":"remove","lines":[" "]},{"start":{"row":89,"column":464},"end":{"row":89,"column":465},"action":"remove","lines":["+"]},{"start":{"row":89,"column":463},"end":{"row":89,"column":464},"action":"remove","lines":[" "]},{"start":{"row":89,"column":462},"end":{"row":89,"column":463},"action":"remove","lines":["e"]},{"start":{"row":89,"column":461},"end":{"row":89,"column":462},"action":"remove","lines":["m"]},{"start":{"row":89,"column":460},"end":{"row":89,"column":461},"action":"remove","lines":["i"]},{"start":{"row":89,"column":459},"end":{"row":89,"column":460},"action":"remove","lines":["T"]},{"start":{"row":89,"column":458},"end":{"row":89,"column":459},"action":"remove","lines":["y"]},{"start":{"row":89,"column":457},"end":{"row":89,"column":458},"action":"remove","lines":["r"]},{"start":{"row":89,"column":456},"end":{"row":89,"column":457},"action":"remove","lines":["e"]},{"start":{"row":89,"column":455},"end":{"row":89,"column":456},"action":"remove","lines":["u"]},{"start":{"row":89,"column":454},"end":{"row":89,"column":455},"action":"remove","lines":["q"]},{"start":{"row":89,"column":453},"end":{"row":89,"column":454},"action":"remove","lines":[" "]},{"start":{"row":89,"column":452},"end":{"row":89,"column":453},"action":"remove","lines":[" "]},{"start":{"row":89,"column":451},"end":{"row":89,"column":452},"action":"remove","lines":["+"]},{"start":{"row":89,"column":450},"end":{"row":89,"column":451},"action":"remove","lines":[" "]},{"start":{"row":89,"column":449},"end":{"row":89,"column":450},"action":"remove","lines":["y"]},{"start":{"row":89,"column":448},"end":{"row":89,"column":449},"action":"remove","lines":["a"]}],[{"start":{"row":89,"column":447},"end":{"row":89,"column":448},"action":"remove","lines":["D"],"id":56},{"start":{"row":89,"column":446},"end":{"row":89,"column":447},"action":"remove","lines":["y"]},{"start":{"row":89,"column":445},"end":{"row":89,"column":446},"action":"remove","lines":["r"]},{"start":{"row":89,"column":444},"end":{"row":89,"column":445},"action":"remove","lines":["e"]},{"start":{"row":89,"column":443},"end":{"row":89,"column":444},"action":"remove","lines":["u"]},{"start":{"row":89,"column":442},"end":{"row":89,"column":443},"action":"remove","lines":["q"]},{"start":{"row":89,"column":441},"end":{"row":89,"column":442},"action":"remove","lines":[" "]},{"start":{"row":89,"column":440},"end":{"row":89,"column":441},"action":"remove","lines":["+"]},{"start":{"row":89,"column":439},"end":{"row":89,"column":440},"action":"remove","lines":[" "]},{"start":{"row":89,"column":438},"end":{"row":89,"column":439},"action":"remove","lines":["\""]},{"start":{"row":89,"column":437},"end":{"row":89,"column":438},"action":"remove","lines":[" "]}],[{"start":{"row":84,"column":0},"end":{"row":84,"column":44},"action":"remove","lines":["app.post('/aaMeetings', function(req, res) {"],"id":57},{"start":{"row":84,"column":0},"end":{"row":85,"column":41},"action":"insert","lines":["//route to query data","app.post('/aaData',  function(req, res) {"]}],[{"start":{"row":84,"column":0},"end":{"row":84,"column":21},"action":"remove","lines":["//route to query data"],"id":58}],[{"start":{"row":85,"column":16},"end":{"row":85,"column":17},"action":"remove","lines":["a"],"id":59},{"start":{"row":85,"column":15},"end":{"row":85,"column":16},"action":"remove","lines":["t"]},{"start":{"row":85,"column":14},"end":{"row":85,"column":15},"action":"remove","lines":["a"]},{"start":{"row":85,"column":13},"end":{"row":85,"column":14},"action":"remove","lines":["D"]}],[{"start":{"row":85,"column":13},"end":{"row":85,"column":14},"action":"insert","lines":["M"],"id":60},{"start":{"row":85,"column":14},"end":{"row":85,"column":15},"action":"insert","lines":["e"]},{"start":{"row":85,"column":15},"end":{"row":85,"column":16},"action":"insert","lines":["e"]},{"start":{"row":85,"column":16},"end":{"row":85,"column":17},"action":"insert","lines":["t"]},{"start":{"row":85,"column":17},"end":{"row":85,"column":18},"action":"insert","lines":["i"]},{"start":{"row":85,"column":18},"end":{"row":85,"column":19},"action":"insert","lines":["n"]},{"start":{"row":85,"column":19},"end":{"row":85,"column":20},"action":"insert","lines":["g"]},{"start":{"row":85,"column":20},"end":{"row":85,"column":21},"action":"insert","lines":["s"]}],[{"start":{"row":98,"column":11},"end":{"row":106,"column":33},"action":"remove","lines":[" // start leaflet js","            // fs.readFile('./aa.hbs', 'utf8', (error, myData) => {","            //     var template = handlebars.compile(myData, data)","            //     // console.log(templateVariables)","            //     templateVariables.blockofMeetings = data;","            //     templateVariables.myData = JSON.stringify(data);","            //     //console.log(templateVariables)","            //     var html = template(templateVariables)","            //     res.send(html)"],"id":61}],[{"start":{"row":99,"column":4},"end":{"row":99,"column":17},"action":"remove","lines":["        // })"],"id":62},{"start":{"row":99,"column":0},"end":{"row":99,"column":4},"action":"remove","lines":["    "]},{"start":{"row":98,"column":11},"end":{"row":99,"column":0},"action":"remove","lines":["",""]},{"start":{"row":98,"column":10},"end":{"row":98,"column":11},"action":"remove","lines":[" "]},{"start":{"row":98,"column":9},"end":{"row":98,"column":10},"action":"remove","lines":[" "]},{"start":{"row":98,"column":8},"end":{"row":98,"column":9},"action":"remove","lines":[" "]},{"start":{"row":98,"column":4},"end":{"row":98,"column":8},"action":"remove","lines":["    "]},{"start":{"row":98,"column":0},"end":{"row":98,"column":4},"action":"remove","lines":["    "]},{"start":{"row":97,"column":36},"end":{"row":98,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":85,"column":0},"end":{"row":85,"column":3},"action":"insert","lines":["// "],"id":63},{"start":{"row":87,"column":0},"end":{"row":87,"column":3},"action":"insert","lines":["// "]},{"start":{"row":88,"column":0},"end":{"row":88,"column":3},"action":"insert","lines":["// "]},{"start":{"row":90,"column":0},"end":{"row":90,"column":3},"action":"insert","lines":["// "]},{"start":{"row":91,"column":0},"end":{"row":91,"column":3},"action":"insert","lines":["// "]},{"start":{"row":92,"column":0},"end":{"row":92,"column":3},"action":"insert","lines":["// "]},{"start":{"row":93,"column":0},"end":{"row":93,"column":3},"action":"insert","lines":["// "]},{"start":{"row":94,"column":0},"end":{"row":94,"column":3},"action":"insert","lines":["// "]},{"start":{"row":95,"column":0},"end":{"row":95,"column":3},"action":"insert","lines":["// "]},{"start":{"row":96,"column":0},"end":{"row":96,"column":3},"action":"insert","lines":["// "]},{"start":{"row":97,"column":0},"end":{"row":97,"column":3},"action":"insert","lines":["// "]},{"start":{"row":99,"column":0},"end":{"row":99,"column":3},"action":"insert","lines":["// "]},{"start":{"row":101,"column":0},"end":{"row":101,"column":3},"action":"insert","lines":["// "]},{"start":{"row":102,"column":0},"end":{"row":102,"column":3},"action":"insert","lines":["// "]}],[{"start":{"row":85,"column":48},"end":{"row":86,"column":0},"action":"remove","lines":["",""],"id":64}]]},"ace":{"folds":[],"scrolltop":1217,"scrollleft":0,"selection":{"start":{"row":85,"column":48},"end":{"row":85,"column":48},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":123,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1575321640751}